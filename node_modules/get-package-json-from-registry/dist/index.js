'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var _getNpmRegistryPackage = require('get-npm-registry-package');

var _getNpmRegistryPackage2 = _interopRequireDefault(_getNpmRegistryPackage);

var _resolveNpmVersion = require('resolve-npm-version');

var _resolveNpmVersion2 = _interopRequireDefault(_resolveNpmVersion);

var _npmPackageArg = require('npm-package-arg');

var _npmPackageArg2 = _interopRequireDefault(_npmPackageArg);

var _immutableObjectMethods = require('immutable-object-methods');

var _fastCache = require('fast-cache');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var setup = function setup(get) {
  return function (arg) {
    var _requested = (typeof arg === 'undefined' ? 'undefined' : _typeof(arg)) === 'object' ? arg : (0, _npmPackageArg2.default)(arg);
    var name = _requested.name,
        rawSpec = _requested.rawSpec;

    var spec = rawSpec || 'latest';

    return get(name).then(function (data) {
      return (0, _immutableObjectMethods.set)((0, _resolveNpmVersion2.default)(data, spec), '_requested', _requested);
    });
  };
};

module.exports = setup(_getNpmRegistryPackage2.default);

module.exports.cached = function () {
  var cache = (0, _fastCache.keyCache)(_getNpmRegistryPackage2.default);

  return setup(function (name) {
    return cache(name);
  });
};