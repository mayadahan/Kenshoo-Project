"use strict";

var fastCache = function fastCache(factory) {
  var cachedPromise = void 0;

  return function () {
    if (cachedPromise) {
      return cachedPromise;
    }

    cachedPromise = factory();

    cachedPromise.catch(function (err) {
      cachedPromise = null;
      throw err;
    });

    return cachedPromise;
  };
};

module.exports = fastCache;

fastCache.keyCache = function (load) {
  var cache = {};
  return function (key) {
    cache[key] = cache[key] || fastCache(function () {
      return load(key);
    });
    return cache[key]();
  };
};